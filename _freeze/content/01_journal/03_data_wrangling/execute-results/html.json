{
  "hash": "592c4a4a1c1dc975a94b279cac412dde",
  "result": {
    "markdown": "---\ntitle: \"Automated Machine Learning with H20 (I)\"\nauthor: \"Tommy Weber\"\n---\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-1_f25f11cab804d72340e4f12cfcbf59a8'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.1     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(skimr)\nlibrary(GGally)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Registered S3 method overwritten by 'GGally':\n#>   method from   \n#>   +.gg   ggplot2\n```\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-2_4d64110e35065473a9fef349d8dfcf8e'}\n\n```{.r .cell-code}\nemployee_attrition_tbl <- read.csv(\"../../../employee_attrition.csv\")\n\npath_data_definitions <- \"../../../data_definitions.xlsx\"\ndefinitions_raw_tbl   <- read_excel(path_data_definitions, sheet = 1, col_names = FALSE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n#> • `` -> `...2`\n```\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-3_ff4a8830e82c8a54a8a313832d822f66'}\n\n```{.r .cell-code}\n# Function to calculate attrition cost\ncalculate_attrition_cost <- function(\n\n  # Employee\n  n                    = 1,\n  salary               = 80000,\n\n  # Direct Costs\n  separation_cost      = 500,\n  vacancy_cost         = 10000,\n  acquisition_cost     = 4900,\n  placement_cost       = 3500,\n\n  # Productivity Costs\n  net_revenue_per_employee = 250000,\n  workdays_per_year        = 240,\n  workdays_position_open   = 40,\n  workdays_onboarding      = 60,\n  onboarding_efficiency    = 0.50\n\n) {\n\n  # Direct Costs\n  direct_cost <- sum(separation_cost, vacancy_cost, acquisition_cost, placement_cost)\n\n  # Lost Productivity Costs\n  productivity_cost <- net_revenue_per_employee / workdays_per_year *\n    (workdays_position_open + workdays_onboarding * onboarding_efficiency)\n\n  # Savings of Salary & Benefits (Cost Reduction)\n  salary_benefit_reduction <- salary / workdays_per_year * workdays_position_open\n\n  # Estimated Turnover Per Employee\n  cost_per_employee <- direct_cost + productivity_cost - salary_benefit_reduction\n\n  # Total Cost of Employee Turnover\n  total_cost <- n * cost_per_employee\n\n  return(total_cost)\n\n}\n\n\ncount_to_pct <- function(data, ..., col = n) {\n\n  # capture the dots\n  grouping_vars_expr <- quos(...)\n  col_expr <- enquo(col)\n\n  ret <- data %>%\n    group_by(!!! grouping_vars_expr) %>%\n    mutate(pct = (!! col_expr) / sum(!! col_expr)) %>%\n    ungroup()\n\n  return(ret)\n\n}\n\n\nassess_attrition <- function(data, attrition_col, attrition_value, baseline_pct) {\n\n  attrition_col_expr <- enquo(attrition_col)\n\n  data %>%\n  \n    # Use parenthesis () to give tidy eval evaluation priority\n    filter((!! attrition_col_expr) %in% attrition_value) %>%\n    arrange(desc(pct)) %>%\n    mutate(\n      # Function inputs in numeric format (e.g. baseline_pct = 0.088 don't require tidy eval)\n      above_industry_avg = case_when(\n        pct > baseline_pct ~ \"Yes\",\n        TRUE ~ \"No\"\n      )\n    )\n\n}\n```\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-4_9c939ae8da8390701ea34fb0e3eb1a9a'}\n\n```{.r .cell-code}\ndept_job_role_tbl <- employee_attrition_tbl %>%\n  select(EmployeeNumber, Department, JobRole, PerformanceRating, Attrition)\n\n\ndept_job_role_tbl %>%\n\n  count(Department, JobRole, Attrition) %>%\n  count_to_pct(Department, JobRole) %>%\n  assess_attrition(Attrition, attrition_value = \"Yes\", baseline_pct = 0.088) %>%\n  mutate(\n    cost_of_attrition = calculate_attrition_cost(n = n, salary = 80000)\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Department\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"JobRole\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Attrition\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pct\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"above_industry_avg\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"cost_of_attrition\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Sales\",\"2\":\"Sales Representative\",\"3\":\"Yes\",\"4\":\"33\",\"5\":\"0.39759036\",\"6\":\"Yes\",\"7\":\"2589950.0\"},{\"1\":\"Research & Development\",\"2\":\"Laboratory Technician\",\"3\":\"Yes\",\"4\":\"62\",\"5\":\"0.23938224\",\"6\":\"Yes\",\"7\":\"4865966.7\"},{\"1\":\"Human Resources\",\"2\":\"Human Resources\",\"3\":\"Yes\",\"4\":\"12\",\"5\":\"0.23076923\",\"6\":\"Yes\",\"7\":\"941800.0\"},{\"1\":\"Sales\",\"2\":\"Sales Executive\",\"3\":\"Yes\",\"4\":\"57\",\"5\":\"0.17484663\",\"6\":\"Yes\",\"7\":\"4473550.0\"},{\"1\":\"Research & Development\",\"2\":\"Research Scientist\",\"3\":\"Yes\",\"4\":\"47\",\"5\":\"0.16095890\",\"6\":\"Yes\",\"7\":\"3688716.7\"},{\"1\":\"Research & Development\",\"2\":\"Manufacturing Director\",\"3\":\"Yes\",\"4\":\"10\",\"5\":\"0.06896552\",\"6\":\"No\",\"7\":\"784833.3\"},{\"1\":\"Research & Development\",\"2\":\"Healthcare Representative\",\"3\":\"Yes\",\"4\":\"9\",\"5\":\"0.06870229\",\"6\":\"No\",\"7\":\"706350.0\"},{\"1\":\"Research & Development\",\"2\":\"Manager\",\"3\":\"Yes\",\"4\":\"3\",\"5\":\"0.05555556\",\"6\":\"No\",\"7\":\"235450.0\"},{\"1\":\"Sales\",\"2\":\"Manager\",\"3\":\"Yes\",\"4\":\"2\",\"5\":\"0.05405405\",\"6\":\"No\",\"7\":\"156966.7\"},{\"1\":\"Research & Development\",\"2\":\"Research Director\",\"3\":\"Yes\",\"4\":\"2\",\"5\":\"0.02500000\",\"6\":\"No\",\"7\":\"156966.7\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-5_5389b230ea2a55bd23380a8d75cc0588'}\n\n```{.r .cell-code}\nplot_ggpairs <- function(data, color = NULL, density_alpha = 0.5) {\n    \n    color_expr <- enquo(color)\n    \n    if (rlang::quo_is_null(color_expr)) {\n        \n        g <- data %>%\n            ggpairs()#lower = \"blank\") \n        \n    } else {\n        \n        color_name <- quo_name(color_expr)\n        \n        g <- data %>%\n            ggpairs(mapping = aes_string(color = color_name), \n                    #lower = \"blank\", \n                    legend = 1,\n                    diag = list(continuous = wrap(\"densityDiag\", \n                                                  alpha = density_alpha))) +\n            theme(legend.position = \"bottom\")\n    }\n    \n    return(g)\n    \n}\n```\n:::\n\n\nExplore Features by Category\n\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-6_122ec7d4a249a36e791ee23cc0d295b7'}\n\n```{.r .cell-code}\n#   1. Descriptive features: age, gender, marital status \nemployee_attrition_tbl %>%\n    select(Attrition, Age, Gender, MaritalStatus, NumCompaniesWorked, Over18, DistanceFromHome) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: `aes_string()` was deprecated in ggplot2 3.0.0.\n#> ℹ Please use tidy evaluation idioms with `aes()`.\n#> ℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-7_c79f73a32649d647112432b66d97faf1'}\n\n```{.r .cell-code}\n#   2. Employment features: department, job role, job level\nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"employee\"), contains(\"department\"), contains(\"job\")) %>%\n    plot_ggpairs(Attrition) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n\n#> Warning in cor(x, y): Standardabweichung ist Null\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-8_c594d6c66999bf7571313431448710e2'}\n\n```{.r .cell-code}\n#   3. Compensation features: HourlyRate, MonthlyIncome, StockOptionLevel \nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"income\"), contains(\"rate\"), contains(\"salary\"), contains(\"stock\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-9_80f1d9dd165fc9ce978af57bcc3723f2'}\n\n```{.r .cell-code}\n#   4. Survey Results: Satisfaction level, WorkLifeBalance \nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"satisfaction\"), contains(\"life\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-10_e636d9a07339069e6e2edce503d420e7'}\n\n```{.r .cell-code}\n#   5. Performance Data: Job Involvment, Performance Rating\nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"performance\"), contains(\"involvement\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-11_a759e954a369373b51f2dce93e45f616'}\n\n```{.r .cell-code}\n#   6. Work-Life Features \nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"overtime\"), contains(\"travel\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-12_03d898113ced52864973ca347adbc960'}\n\n```{.r .cell-code}\n#   7. Training and Education \nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"training\"), contains(\"education\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='03_data_wrangling_cache/html/unnamed-chunk-13_1d7f31ff0715dcf3f9c2bb3af6d892ab'}\n\n```{.r .cell-code}\n#   8. Time-Based Features: Years at company, years in current role\nemployee_attrition_tbl %>%\n    select(Attrition, contains(\"years\")) %>%\n    plot_ggpairs(Attrition)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n#> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](03_data_wrangling_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nFeature investigation:\n\n1. Compensation Features\n\nWhat can you deduce about the interaction between Monthly Income and Attrition?\n\nc) Those that are leaving have a lower Monthly Income\n\n2. Compensation Features\n\nWhat can you deduce about the interaction between Percent Salary Hike and Attrition?\n\nc) Those that are leaving have lower Percent Salary Hike\n\n3. Compensation Features\n\nWhat can you deduce about the interaction between Stock Option Level and Attrition?\n\nc) It's difficult to deduce anything based on the visualization\n\n4. Survey Results\n\nWhat can you deduce about the interaction between Environment Satisfaction and Attrition?\n\na) A higher proportion of those leaving have a low environment satisfaction level\n\n5. Survey Results\n\nWhat can you deduce about the interaction between Work Life Balance and Attrition\n\nb) Those that are staying have a higher density of 2's and 3's\n\n6. Performance Data\n\nWhat Can you deduce about the interaction between Job Involvement and Attrition?\n\na) Those that are leaving have a lower density of 3's and 4's\n\n7. Work-Life Features\n\nWhat can you deduce about the interaction between Over Time and Attrition?\n\na) The proportion of those leaving that are working Over Time are high compared to those that are not leaving\n\n8. Training and Education\n\nWhat can you deduce about the interaction between Training Times Last Year and Attrition\n\nc) It's difficult to deduce anything based on the visualization\n\n9. Time-Based Features\n\nWhat can you deduce about the interaction between Years At Company and Attrition\n\nb) People that leave tend to have less working years at the company\n\n10. Time-Based Features\n\nWhat can you deduce about the interaction between Years Since Last Promotion and Attrition?\n\nb) Those that are leaving have fewer years since last promotion than those that are staying\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}