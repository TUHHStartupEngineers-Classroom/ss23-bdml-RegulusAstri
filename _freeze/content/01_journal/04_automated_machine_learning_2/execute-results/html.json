{
  "hash": "65a4bd4e4a34de161c0337fb962f3c19",
  "result": {
    "markdown": "---\ntitle: \"Automated Machine Learning with H20 (II)\"\nauthor: \"Tommy Weber\"\n---\n\n\n### Importing Libraries\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-1_f4f0f720e171b61ec1c462559f66295f'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(rsample)\nlibrary(recipes)\nlibrary(h2o)\n```\n:::\n\n\n---\n\n### Initializing H2O\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-2_3db6ffe1a35d912601ebce4f282b885f'}\n\n```{.r .cell-code}\nh2o.init()\nset.seed(seed = 1113)\n```\n:::\n\n\n---\n\n### Loading and Splitting Data\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-3_cca9adefbc0c793b433918fcf4dc489f'}\n\n```{.r .cell-code}\nproduct_backorder_tbl <- read.csv(\"../../../product_backorders.csv\")\n\nsplit_obj <- rsample::initial_split(product_backorder_tbl, prop = 0.85)\n\ntrain_readable_tbl <- training(split_obj)\ntest_readable_tbl <- testing(split_obj)\n```\n:::\n\n\n---\n\n### Recipe Definition and Application\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-4_53bdce0cbce4b6c27947ac135a7b66d7'}\n\n```{.r .cell-code}\nrecipe_obj <- recipe(went_on_backorder ~ ., data = train_readable_tbl) %>% \n  update_role(sku, new_role = \"ID\") %>% \n  step_zv(all_predictors()) %>% \n  step_mutate_at(all_nominal(), fn = as.factor) %>% \n  prep()\n\ntrain_tbl <- bake(recipe_obj, new_data = train_readable_tbl)\ntest_tbl <- bake(recipe_obj, new_data = test_readable_tbl)\n\nsplit_h2o <- h2o.splitFrame(as.h2o(train_tbl), ratios = c(0.85), seed = 1234)\ntrain_h2o <- split_h2o[[1]]\nvalid_h2o <- split_h2o[[2]]\ntest_h2o <- as.h2o(test_tbl)\n```\n:::\n\n\n---\n\n### Auto-Modeling\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-5_0ed05564cb2a07c44cc3e695b82bc1c3'}\n\n```{.r .cell-code}\ny <- \"went_on_backorder\"\nx <- setdiff(names(train_h2o), c(y, \"sku\"))\n\nautoml_models_h2o <- h2o.automl(\n  x = x,\n  y = y,\n  training_frame = train_h2o,\n  validation_frame = valid_h2o,\n  leaderboard_frame = test_h2o,\n  max_runtime_secs = 30,\n  nfolds = 5\n)\n```\n:::\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-6_a5893e94ff0017ed2ffa7d42e60ab217'}\n\n```{.r .cell-code}\nautoml_models_h2o@leaderboard\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>                                                  model_id       auc   logloss\n#> 1                          GBM_4_AutoML_8_20230613_212052 0.9465800 0.1834729\n#> 2 StackedEnsemble_BestOfFamily_3_AutoML_8_20230613_212052 0.9459006 0.1797696\n#> 3 StackedEnsemble_BestOfFamily_2_AutoML_8_20230613_212052 0.9454242 0.1804093\n#> 4    StackedEnsemble_AllModels_1_AutoML_8_20230613_212052 0.9449883 0.1796356\n#> 5                          GBM_3_AutoML_8_20230613_212052 0.9433799 0.1852992\n#> 6                          GBM_2_AutoML_8_20230613_212052 0.9416835 0.1878870\n#>       aucpr mean_per_class_error      rmse        mse\n#> 1 0.7235563            0.1781963 0.2343908 0.05493906\n#> 2 0.7368489            0.1242785 0.2325751 0.05409118\n#> 3 0.7348444            0.1449337 0.2328003 0.05419600\n#> 4 0.7432835            0.1615650 0.2322328 0.05393208\n#> 5 0.7380727            0.1681595 0.2338296 0.05467627\n#> 6 0.7241084            0.1775996 0.2347489 0.05510705\n#> \n#> [13 rows x 7 columns]\n```\n:::\n:::\n\n\n---\n\n### Prediction\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-7_0cf17e1a0aef927ec472b23ed27cac86'}\n\n```{.r .cell-code}\nleader <- automl_models_h2o %>% h2o.get_best_model()\n\npredictions <- h2o.predict(leader, newdata = test_h2o)\n```\n:::\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-8_f091c9eef590a2a2abc5eb5517497af0'}\n\n```{.r .cell-code}\npredictions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>   predict        No       Yes\n#> 1      No 0.7329215 0.2670785\n#> 2     Yes 0.3753872 0.6246128\n#> 3     Yes 0.5454352 0.4545648\n#> 4     Yes 0.6560820 0.3439180\n#> 5     Yes 0.1106067 0.8893933\n#> 6      No 0.8265082 0.1734918\n#> \n#> [2858 rows x 3 columns]\n```\n:::\n:::\n\n\n---\n\n### Saving\n\n\n::: {.cell hash='04_automated_machine_learning_2_cache/html/unnamed-chunk-9_41bc6fad7cbb8d25b28bc267c8d9acb6'}\n\n```{.r .cell-code}\nleader %>% h2o.saveModel(\"../../my_models/AutoML2_Model\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}